<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Respiratory ‚Äì PIPC</title>

<style>
  :root{
    --bg: #f3f5f8;
    --card: #ffffff;
    --text: #111827;
    --muted: #6b7280;
    --blue: #1e88e5;
    --border: #e5e7eb;
    --shadow: 0 6px 18px rgba(0,0,0,0.12);

    --danger-bg: #fff1f2;
    --danger-border: #fecdd3;
    --danger-text: #b91c1c;

    --sec-bg: #f1f8ff;
    --sec-border: #dbeafe;

    --sec2-bg: #f7f7ff;
    --sec2-border: #e0e7ff;

    --sec3-bg: #f6fffb;
    --sec3-border: #bbf7d0;
  }

  body{
    font-family: Arial, sans-serif;
    margin: 0;
    background: var(--bg);
    color: var(--text);
  }

  /* HEADER */
  .topbar{
    background: var(--card);
    border-bottom: 1px solid var(--border);
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  }
  .topbar-inner{
    max-width: 1100px;
    margin: 0 auto;
    padding: 14px 16px;
    display: flex;
    align-items: center;
    gap: 14px;
  }
  .brand{
    display: flex;
    align-items: center;
    gap: 10px;
    text-decoration: none;
    color: inherit;
  }
  .brand img{ height: 44px; width: auto; display: block; }
  .brand-title{ font-weight: 900; letter-spacing: 0.2px; }
  .page-title{
    margin-left: auto;
    font-size: 1.05rem;
    font-weight: 900;
    color: #0f172a;
  }

  /* CONTENT */
  .wrap{
    max-width: 1100px;
    margin: 18px auto;
    padding: 0 16px 110px 16px; /* extra space for footer/banner */
  }
  .crumb{ margin: 8px 0 14px 0; }
  .crumb a{
    text-decoration: none;
    color: var(--blue);
    font-weight: 900;
  }
  h1{ margin: 6px 0 6px 0; font-size: 2.0rem; }
  p.sub{ margin: 0 0 18px 0; color: var(--muted); line-height: 1.4; }

  /* GRID */
  .grid{
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 14px;
  }

  .tile{
    position: relative;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 14px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    cursor: pointer;
    transition: transform 0.06s ease, box-shadow 0.12s ease;
  }
  .tile:hover{
    transform: translateY(-1px);
    box-shadow: 0 10px 22px rgba(0,0,0,0.08);
  }
  .tile h3{ margin: 0 0 6px 0; font-size: 1.06rem; }
  .tile p{ margin: 0; color: var(--muted); font-size: 0.92rem; }

  /* Subtle red flags pill */
  .flag-pill{
    position: absolute;
    top: 10px;
    right: 10px;
    border: 1px solid var(--danger-border);
    background: var(--danger-bg);
    color: var(--danger-text);
    font-weight: 900;
    font-size: 0.78rem;
    padding: 5px 8px;
    border-radius: 999px;
    cursor: pointer;
    user-select: none;
  }

  /* ===== Overlay (tap outside to close) ===== */
  .overlay{
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.35);
    z-index: 999; /* below window */
    display: none;
  }

  /* WINDOWS */
  .window{
    position: fixed;
    top: 110px;
    left: 120px;
    width: min(820px, 92vw);
    background: var(--card);
    border-radius: 14px;
    box-shadow: var(--shadow);
    border: 1px solid var(--border);
    z-index: 1000; /* above overlay */
    box-sizing: border-box;
  }

  .window-header{
    padding: 10px 12px;
    background: var(--blue);
    color: white;
    cursor: move;
    border-radius: 14px 14px 0 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    user-select: none;
    font-weight: 900;
  }

  .window-body{
    padding: 14px;
    max-height: 70vh;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }

  .close{
    cursor: pointer;
    font-weight: 900;
    padding: 2px 8px;
    border-radius: 8px;
    background: rgba(255,255,255,0.15);
  }

  /* SECTION CARDS */
  .section{
    border: 1px solid var(--sec-border);
    background: var(--sec-bg);
    border-radius: 12px;
    padding: 12px;
    margin: 10px 0;
  }
  .section.alt{
    border-color: var(--sec2-border);
    background: var(--sec2-bg);
  }
  .section.good{
    border-color: var(--sec3-border);
    background: var(--sec3-bg);
  }
  .section.danger{
    border-color: var(--danger-border);
    background: var(--danger-bg);
  }

  .section h4{
    margin: 0 0 8px 0;
    font-size: 0.95rem;
    letter-spacing: 0.2px;
    text-transform: uppercase;
  }

  .section ul{
    margin: 0;
    padding-left: 18px;
  }
  .section li{ margin: 6px 0; }

  .mini-note{
    margin-top: 8px;
    color: var(--muted);
    font-size: 0.9rem;
    line-height: 1.35;
  }

  .links a{
    color: var(--blue);
    font-weight: 900;
    text-decoration: none;
  }

  /* Comparison tables */
  table.compare{
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
    font-size: 0.92rem;
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
    background: white;
  }
  .compare th{
    background: #e3f2fd;
    padding: 10px;
    text-align: left;
    font-weight: 900;
  }
  .compare td{
    padding: 10px;
    border-top: 1px solid var(--border);
    vertical-align: top;
  }
  .goodTxt{ color: #1b5e20; font-weight: 900; }
  .midTxt{  color: #e65100; font-weight: 900; }
  .badTxt{  color: #b91c1c; font-weight: 900; }

  /* ===== Mobile window behaviour: fit screen + no sideways overflow ===== */
  @media (max-width: 820px){
    .window{
      left: 12px;
      right: 12px;
      top: 88px;     /* below topbar */
      bottom: 14px;  /* keep off the very bottom */
      width: auto;
      max-width: none;
    }
    .window-header{
      cursor: default; /* dragging is awkward on mobile */
    }
    .window-body{
      max-height: calc(100vh - 88px - 14px - 44px);
      overflow-y: auto;
    }
    .window, .window *{
      max-width: 100%;
      box-sizing: border-box;
      overflow-wrap: anywhere;
      word-break: break-word;
    }
  }

  @media (max-width: 520px){
    .page-title{ display: none; }
    .brand img{ height: 40px; }
  }

  /* ===== Site-wide footer + disclaimer banner + first-visit modal ===== */

  .site-footer{
    position: fixed;
    left: 0; right: 0; bottom: 0;
    z-index: 50;
    background: var(--card);
    border-top: 1px solid var(--border);
    box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
  }
  .site-footer-inner{
    max-width: 1100px;
    margin: 0 auto;
    padding: 10px 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    color: var(--muted);
    font-size: 0.9rem;
  }
  .site-footer a{
    color: var(--blue);
    font-weight: 900;
    text-decoration: none;
  }
  .site-footer a:hover{ text-decoration: underline; }

  .disclaimer-banner{
    position: fixed;
    left: 50%;
    transform: translateX(-50%);
    bottom: 54px; /* above footer */
    width: min(1100px, calc(100% - 24px));
    z-index: 60;
    background: #e3f2fd;
    border: 1px solid #bbdefb;
    border-radius: 12px;
    padding: 10px 12px;
    display: flex;
    gap: 10px;
    align-items: flex-start;
    justify-content: space-between;
    box-shadow: 0 10px 22px rgba(0,0,0,0.10);
  }
  .disclaimer-banner strong{ color: #0f172a; }
  .banner-actions{
    display: flex;
    gap: 8px;
    align-items: center;
    white-space: nowrap;
  }
  .btn{
    border: 1px solid var(--border);
    background: white;
    color: #0f172a;
    font-weight: 900;
    padding: 8px 10px;
    border-radius: 10px;
    cursor: pointer;
    font-size: 0.9rem;
    text-decoration: none;
  }
  .btn:hover{ filter: brightness(0.98); }

  .modal-overlay{
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.40);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 2000; /* above your overlay/window */
    padding: 16px;
  }
  .modal{
    width: min(720px, 100%);
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 14px;
    box-shadow: var(--shadow);
    overflow: hidden;
  }
  .modal-head{
    padding: 12px 14px;
    background: var(--blue);
    color: white;
    font-weight: 900;
  }
  .modal-body{
    padding: 14px;
    color: var(--text);
  }
  .modal-body p{
    margin: 0 0 10px 0;
    color: var(--muted);
    line-height: 1.4;
  }
  .modal-body ul{ margin: 0; padding-left: 18px; }
  .modal-body li{ margin: 6px 0; }
  .modal-foot{
    padding: 12px 14px 14px;
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    border-top: 1px solid var(--border);
    background: #fafafa;
  }

  @media (max-width: 520px){
    .site-footer-inner{ flex-direction: column; align-items: flex-start; }
    .banner-actions{ flex-wrap: wrap; justify-content: flex-end; }
  }
</style>
</head>

<body>

<!-- Overlay (tap anywhere outside the window to close) -->
<div id="overlay" class="overlay" aria-hidden="true"></div>

<header class="topbar">
  <div class="topbar-inner">
    <a class="brand" href="index.html" title="Back to Home">
      <img src="assets/pipc-short.png" alt="PIPC logo" />
      <div class="brand-title">PIPC</div>
    </a>
    <div class="page-title">Respiratory</div>
  </div>
</header>

<div class="wrap">
  <div class="crumb"><a href="index.html">‚Üê Home</a></div>

  <h1>Respiratory</h1>
  <p class="sub">Tap a tile for detail. Sections are separated for fast scanning. Use the small üö© pill for red flags.</p>

  <div class="grid">
    <div class="tile" onclick="openWindow('comparisons')">
      <h3>üìä Comparisons</h3>
      <p>Fast side-by-side tables (scan in seconds).</p>
      <div class="flag-pill" onclick="event.stopPropagation(); openRedFlags('respiratory')">üö©</div>
    </div>

    <div class="tile" onclick="openWindow('asthma')">
      <h3>üí® Asthma</h3>
      <p>Wheeze ‚Ä¢ tight chest ‚Ä¢ ‚Üë inhaler use</p>
      <div class="flag-pill" onclick="event.stopPropagation(); openRedFlags('asthma')">üö©</div>
    </div>

    <div class="tile" onclick="openWindow('urti')">
      <h3>ü§ß Viral URTI</h3>
      <p>Runny nose ‚Ä¢ sore throat ‚Ä¢ headache</p>
      <div class="flag-pill" onclick="event.stopPropagation(); openRedFlags('urti')">üö©</div>
    </div>

    <div class="tile" onclick="openWindow('bronchitis')">
      <h3>ü´Å Acute Bronchitis</h3>
      <p>Post-viral cough ‚Ä¢ usually self-limiting</p>
      <div class="flag-pill" onclick="event.stopPropagation(); openRedFlags('bronchitis')">üö©</div>
    </div>

    <div class="tile" onclick="openWindow('copd')">
      <h3>ü´Å COPD Exacerbation</h3>
      <p>‚Üë breathlessness ‚Ä¢ sputum change</p>
      <div class="flag-pill" onclick="event.stopPropagation(); openRedFlags('copd')">üö©</div>
    </div>

    <div class="tile" onclick="openWindow('pneumonia')">
      <h3>ü¶† Pneumonia</h3>
      <p>Fever ‚Ä¢ pleuritic pain ‚Ä¢ focal signs</p>
      <div class="flag-pill" onclick="event.stopPropagation(); openRedFlags('pneumonia')">üö©</div>
    </div>

    <div class="tile" onclick="openWindow('pe')">
      <h3>ü©∏ Pulmonary Embolism</h3>
      <p>Sudden SOB ‚Ä¢ pleuritic pain ‚Ä¢ tachycardia</p>
      <div class="flag-pill" onclick="event.stopPropagation(); openRedFlags('pe')">üö©</div>
    </div>

    <div class="tile" onclick="openWindow('ptx')">
      <h3>üéà Pneumothorax</h3>
      <p>Sudden pain ‚Ä¢ reduced air entry</p>
      <div class="flag-pill" onclick="event.stopPropagation(); openRedFlags('ptx')">üö©</div>
    </div>

    <div class="tile" onclick="openWindow('hf')">
      <h3>üíî Heart Failure</h3>
      <p>Orthopnoea/PND ‚Ä¢ oedema ‚Ä¢ crackles</p>
      <div class="flag-pill" onclick="event.stopPropagation(); openRedFlags('hf')">üö©</div>
    </div>
  </div>
</div>

<script>
let zIndexCounter = 1000;

const overlay = document.getElementById("overlay");

function showOverlay(){
  overlay.style.display = "block";
  overlay.setAttribute("aria-hidden", "false");
  document.body.style.overflow = "hidden"; // stop background scroll on mobile
}
function hideOverlay(){
  overlay.style.display = "none";
  overlay.setAttribute("aria-hidden", "true");
  document.body.style.overflow = ""; // restore
}

/* Close any open window (we keep ONE open at a time for clean mobile UX) */
function closeAllWindows(){
  document.querySelectorAll(".window").forEach(w => w.remove());
  hideOverlay();
}

/* Tap outside to close */
overlay.addEventListener("click", closeAllWindows);

/* ESC to close (desktop) */
document.addEventListener("keydown", (e) => {
  if(e.key === "Escape") closeAllWindows();
});

/* Window helpers */
function createWindow(title, html) {
  // Keep one open at a time (prevents stacking issues on mobile)
  closeAllWindows();

  showOverlay();

  const win = document.createElement("div");
  win.className = "window";
  win.style.zIndex = ++zIndexCounter;

  win.innerHTML = `
    <div class="window-header">
      ${title}
      <span class="close" onclick="closeWindow(this)">‚úñ</span>
    </div>
    <div class="window-body">${html}</div>
  `;

  document.body.appendChild(win);
  makeDraggable(win);

  // Bring to front if user taps inside (desktop nicety)
  win.addEventListener("mousedown", () => {
    win.style.zIndex = ++zIndexCounter;
  });
}

function closeWindow(closeEl){
  const win = closeEl.closest(".window");
  if(win) win.remove();
  hideOverlay();
}

function makeDraggable(win) {
  const header = win.querySelector(".window-header");
  let dragging = false, offsetX = 0, offsetY = 0;

  // Only enable drag on non-touch / wider screens
  function canDrag(){
    return window.matchMedia("(min-width: 821px)").matches;
  }

  header.addEventListener("mousedown", (e) => {
    if(!canDrag()) return;
    dragging = true;
    win.style.zIndex = ++zIndexCounter;
    offsetX = e.clientX - win.offsetLeft;
    offsetY = e.clientY - win.offsetTop;
    document.body.style.userSelect = "none";
  });

  document.addEventListener("mousemove", (e) => {
    if (!dragging) return;
    win.style.left = (e.clientX - offsetX) + "px";
    win.style.top  = (e.clientY - offsetY) + "px";
  });

  document.addEventListener("mouseup", () => {
    dragging = false;
    document.body.style.userSelect = "auto";
  });
}

/* Section builder */
function section(title, items, variant="") {
  const cls = variant ? `section ${variant}` : "section";
  const list = (items || []).map(x => `<li>${x}</li>`).join("");
  return `
    <div class="${cls}">
      <h4>${title}</h4>
      <ul>${list}</ul>
    </div>
  `;
}
function linksSection(title, links) {
  const list = (links || []).map(l => `<li class="links"><a href="${l.href}" target="_blank">${l.label}</a></li>`).join("");
  return `
    <div class="section alt">
      <h4>${title}</h4>
      <ul>${list}</ul>
    </div>
  `;
}

/* Content windows */
function openWindow(key) {
  const content = {

    comparisons: `
      <div class="section">
        <h4>URTI vs Bronchitis vs Pneumonia</h4>
        <table class="compare">
          <tr><th>Feature</th><th>URTI</th><th>Bronchitis</th><th>Pneumonia</th></tr>
          <tr><td>Fever</td><td class="goodTxt">None / low</td><td class="midTxt">Mild</td><td class="badTxt">High / rigors</td></tr>
          <tr><td>Key symptoms</td><td>Runny nose, sore throat, headache</td><td>Cough (often persistent)</td><td>Cough + systemically unwell</td></tr>
          <tr><td>Chest exam</td><td class="goodTxt">Clear</td><td class="midTxt">Wheeze / rhonchi</td><td class="badTxt">Focal crackles / bronchial breathing</td></tr>
          <tr><td>SpO‚ÇÇ</td><td class="goodTxt">Normal</td><td class="goodTxt">Usually normal</td><td class="badTxt">May be reduced</td></tr>
          <tr><td>Antibiotics</td><td class="goodTxt">No</td><td class="goodTxt">No (usually)</td><td class="badTxt">Yes (local + NICE)</td></tr>
        </table>
      </div>

      <div class="section alt">
        <h4>Asthma vs COPD vs HF (quick cues)</h4>
        <table class="compare">
          <tr><th>Clue</th><th>Asthma</th><th>COPD</th><th>Heart failure</th></tr>
          <tr><td>Typical history</td><td>Atopy/variable symptoms</td><td>Smoking/chronic symptoms</td><td>Cardiac history, fluid overload</td></tr>
          <tr><td>Chest</td><td class="midTxt">Wheeze common</td><td class="midTxt">Wheeze + reduced air entry</td><td class="badTxt">Crackles ¬± wheeze (‚Äúcardiac‚Äù)</td></tr>
          <tr><td>Other clues</td><td>Triggered by viral/allergen</td><td>Sputum change in exacerbation</td><td class="badTxt">Oedema, orthopnoea/PND</td></tr>
        </table>
        <div class="mini-note links">
          <strong>NICE CKS search:</strong>
          <a href="https://cks.nice.org.uk/" target="_blank">https://cks.nice.org.uk/</a>
        </div>
      </div>
    `,

    asthma: `
      ${section("Definition", [
        "Inflammatory condition of the airways causing narrowing during exacerbations ‚Üí wheeze."
      ])}

      ${section("Signs & symptoms", [
        "Increased respiratory rate",
        "Tight chest",
        "Increased inhaler use",
        "Peak flow varies with severity"
      ], "alt")}

      ${section("Quick assessment", [
        "Work of breathing, speaking in sentences, fatigue",
        "SpO‚ÇÇ (baseline if known)",
        "Wheeze? (silent chest is worrying)",
        "Triggers: viral illness, allergens, technique/adherence",
        "Check personal asthma action plan"
      ], "good")}

      ${section("Treatment / management (Primary Care)", [
        "Consider prednisolone (e.g. 40mg) if wheeze chest (follow local guidance)",
        "Consider how much inhaler has been used (SABA/MART)",
        "Clinical judgement: many exacerbations are viral",
        "Check for LRTI signs: focal chest sounds, fever, reduced SpO‚ÇÇ",
        "Review inhaler technique + spacer use",
        "Consider asthma review if exacerbated or due"
      ])}

      ${section("Not just asthma (differentials)", [
        "Fever + focal chest signs ‚Üí consider pneumonia",
        "Pleuritic chest pain + risk factors ‚Üí consider PE",
        "Orthopnoea + oedema + bibasal crackles ‚Üí consider HF",
        "Sudden unilateral reduced air entry ‚Üí consider pneumothorax"
      ], "alt")}

      ${linksSection("Guidelines", [
        { label: "NICE CKS ‚Äì Asthma", href: "https://cks.nice.org.uk/topics/asthma/" },
        { label: "BTS / SIGN Asthma Guideline", href: "https://www.brit-thoracic.org.uk/quality-improvement/guidelines/asthma/" }
      ])}
    `,

    urti: `
      ${section("Definition", [
        "Self-limiting viral infection of the upper airway (nose/throat). Antibiotics usually not indicated."
      ])}

      ${section("Key features (KISS)", [
        "Runny/blocked nose",
        "Sore throat",
        "Headache",
        "Mild cough",
        "Low-grade fever",
        "Myalgia / fatigue"
      ], "alt")}

      ${section("Quick assessment", [
        "Duration + severity",
        "Hydration",
        "Baseline risk: frailty, immunosuppression, comorbidity"
      ], "good")}

      ${section("Management (Primary Care)", [
        "Safety-net + expected course (often 7‚Äì10 days; cough can last longer)",
        "Fluids + rest",
        "Simple analgesia (if appropriate)",
        "Saline sprays/irrigation",
        "Avoid antibiotics unless clear indication (local + NICE CKS)"
      ])}

      ${linksSection("Guidelines", [
        { label: "NICE CKS ‚Äì Common cold", href: "https://cks.nice.org.uk/topics/common-cold/" },
        { label: "NICE CKS ‚Äì Sore throat (acute)", href: "https://cks.nice.org.uk/topics/sore-throat-acute/" }
      ])}
    `,

    bronchitis: `
      ${section("Definition", [
        "Acute inflammation of the bronchi (usually viral), commonly after URTI."
      ])}

      ${section("Signs & symptoms", [
        "Cough often 2‚Äì3 weeks",
        "Sputum may be present (does not automatically mean bacterial)",
        "Chest discomfort",
        "Wheeze can occur"
      ], "alt")}

      ${section("Quick assessment", [
        "RR, HR, temperature, SpO‚ÇÇ",
        "Chest: often wheeze/rhonchi; usually no focal crackles"
      ], "good")}

      ${section("Antibiotics", [
        "Usually NO antibiotics",
        "If high-risk/atypical course ‚Üí follow local antimicrobial guidance + NICE CKS criteria"
      ])}

      ${linksSection("Guidelines", [
        { label: "NICE CKS ‚Äì Acute bronchitis", href: "https://cks.nice.org.uk/topics/acute-bronchitis/" }
      ])}
    `,

    copd: `
      ${section("Definition", [
        "Acute worsening of COPD symptoms beyond day-to-day variation (often viral trigger)."
      ])}

      ${section("Signs & symptoms", [
        "Increased breathlessness",
        "Increased sputum volume and/or purulence",
        "Increased cough/wheeze",
        "Reduced exercise tolerance"
      ], "alt")}

      ${section("Quick assessment", [
        "ABCDE + SpO‚ÇÇ (baseline if known)",
        "Check for focal crackles (pneumonia)",
        "Ask: rescue pack? prior NIV/admissions?"
      ], "good")}

      ${section("Treatment / management (Primary Care)", [
        "Optimise bronchodilators per local pathway",
        "Consider steroids if indicated (local guidance)",
        "Safety-net + arrange review"
      ])}

      ${section("Antibiotics", [
        "Not for all exacerbations",
        "Consider if bacterial features or per local criteria",
        "Choose first-line per LOCAL antimicrobial guidance; cross-check NICE CKS"
      ], "alt")}

      ${linksSection("Guidelines", [
        { label: "NICE CKS ‚Äì COPD", href: "https://cks.nice.org.uk/topics/chronic-obstructive-pulmonary-disease/" }
      ])}
    `,

    pneumonia: `
      ${section("Definition", [
        "Infection of lung tissue causing inflammation/consolidation."
      ])}

      ${section("Signs & symptoms", [
        "Fever/rigors",
        "Cough +/- sputum",
        "Pleuritic chest pain",
        "Breathlessness",
        "Focal crackles/bronchial breathing",
        "Confusion (esp. older adults)"
      ], "alt")}

      ${section("Quick assessment", [
        "Vitals + SpO‚ÇÇ",
        "Sepsis screen / systemic unwell?",
        "Focal chest findings?"
      ], "good")}

      ${section("Antibiotics (first-line)", [
        "Choose first-line antibiotic per LOCAL antimicrobial guidance first",
        "Cross-check NICE CKS for indications/alternatives (e.g. allergy)"
      ])}

      ${linksSection("Guidelines", [
        { label: "NICE CKS ‚Äì Pneumonia (adults)", href: "https://cks.nice.org.uk/topics/pneumonia-adults/" }
      ])}
    `,

    pe: `
      ${section("Definition", [
        "Thrombus in pulmonary arterial circulation ‚Üí V/Q mismatch. Potentially life-threatening."
      ])}

      ${section("Signs & symptoms", [
        "Sudden breathlessness",
        "Pleuritic chest pain",
        "Tachycardia",
        "Cough +/- haemoptysis",
        "Syncope/pre-syncope (worrying)"
      ], "alt")}

      ${section("Quick assessment", [
        "ABCDE + SpO‚ÇÇ",
        "Risk factors: immobility/surgery, cancer, prior VTE, pregnancy/post-partum, oestrogen, long travel",
        "DVT signs: unilateral leg swelling/pain"
      ], "good")}

      ${section("Action", [
        "If suspected ‚Üí urgent same-day emergency assessment (follow local pathway)"
      ])}

      ${linksSection("Guidelines", [
        { label: "NICE CKS ‚Äì Pulmonary embolism", href: "https://cks.nice.org.uk/topics/pulmonary-embolism/" }
      ])}
    `,

    ptx: `
      ${section("Definition", [
        "Air in pleural space causing lung collapse (spontaneous or traumatic)."
      ])}

      ${section("Signs & symptoms", [
        "Sudden unilateral pleuritic chest pain",
        "Sudden breathlessness",
        "Reduced/absent breath sounds on affected side"
      ], "alt")}

      ${section("Action", [
        "Suspected pneumothorax usually needs urgent same-day assessment/imaging",
        "Escalate immediately if unstable / suspected tension"
      ], "good")}

      ${linksSection("Guidelines", [
        { label: "NICE CKS ‚Äì Pneumothorax", href: "https://cks.nice.org.uk/topics/pneumothorax/" }
      ])}
    `,

    hf: `
      ${section("Definition", [
        "Impaired cardiac function ‚Üí fluid overload and reduced perfusion. Can present as breathlessness."
      ])}

      ${section("Signs & symptoms", [
        "Breathlessness",
        "Orthopnoea / PND",
        "Peripheral oedema",
        "Weight gain",
        "Bibasal crackles",
        "Fatigue"
      ], "alt")}

      ${section("Quick assessment", [
        "Vitals + SpO‚ÇÇ",
        "Look for fluid overload signs",
        "Triggers: infection, arrhythmia, ACS, non-adherence"
      ], "good")}

      ${section("Action", [
        "Acute pulmonary oedema / severe distress ‚Üí urgent escalation",
        "If stable ‚Üí follow local pathway/plan + arrange review"
      ])}

      ${linksSection("Guidelines", [
        { label: "NICE CKS ‚Äì Heart failure", href: "https://cks.nice.org.uk/topics/heart-failure/" }
      ])}
    `
  };

  createWindow(titleFor(key), content[key] || "<div class='section'><h4>Not found</h4><p>Content not found.</p></div>");
}

/* Red flags */
function openRedFlags(topic) {
  const flags = {
    respiratory: [
      "SpO‚ÇÇ persistently low or dropping",
      "Severe breathlessness / exhaustion",
      "Chest pain suggestive of ACS/PE",
      "Haemoptysis",
      "Confusion / reduced consciousness",
      "Sepsis features",
      "Rapid deterioration"
    ],
    asthma: [
      "Silent chest / very poor air entry",
      "Unable to speak in sentences / exhaustion",
      "SpO‚ÇÇ low or falling",
      "Cyanosis, agitation or drowsiness",
      "Poor response to reliever / worsening work of breathing"
    ],
    urti: [
      "Severe breathlessness / distress",
      "SpO‚ÇÇ low for patient",
      "Stridor/drooling/airway concern",
      "Sepsis features",
      "Severe dehydration / unable to swallow fluids",
      "Chest pain suggestive of ACS/PE"
    ],
    bronchitis: [
      "SpO‚ÇÇ low, increasing breathlessness",
      "Focal chest signs + fever (consider pneumonia)",
      "Significant haemoptysis",
      "Sepsis features",
      "High-risk patient deteriorating"
    ],
    copd: [
      "Drowsiness/confusion/exhaustion (possible hypercapnia)",
      "SpO‚ÇÇ persistently low despite treatment",
      "Severe distress/cyanosis",
      "Sepsis features",
      "New chest pain/arrhythmia"
    ],
    pneumonia: [
      "SpO‚ÇÇ low / respiratory distress",
      "Sepsis features / hypotension",
      "Confusion/exhaustion",
      "Unable to maintain oral intake",
      "Rapid deterioration"
    ],
    pe: [
      "Syncope/collapse",
      "Hypotension/shock",
      "Severe hypoxia",
      "Severe chest pain suggestive of ACS",
      "Significant haemoptysis"
    ],
    ptx: [
      "Suspected tension (shock/hypotension)",
      "Severe respiratory distress",
      "SpO‚ÇÇ very low / rapidly worsening",
      "Reduced consciousness"
    ],
    hf: [
      "Acute pulmonary oedema / severe distress",
      "SpO‚ÇÇ low / exhaustion",
      "Hypotension/syncope",
      "Chest pain suggestive of ACS",
      "New significant arrhythmia"
    ]
  };

  const list = flags[topic] || flags.respiratory;

  const html = `
    <div class="section danger">
      <h4>FAST RED FLAGS</h4>
      <ul>
        ${list.map(x => `<li><strong>${x}</strong></li>`).join("")}
      </ul>
      <div class="mini-note">If concerned: follow local escalation pathways.</div>
    </div>
  `;

  createWindow("üö© Red Flags", html);
}

/* Titles */
function titleFor(key){
  const map = {
    comparisons: "Comparisons",
    asthma: "Asthma",
    urti: "Viral URTI",
    bronchitis: "Acute Bronchitis",
    copd: "COPD Exacerbation",
    pneumonia: "Pneumonia",
    pe: "Pulmonary Embolism",
    ptx: "Pneumothorax",
    hf: "Heart Failure"
  };
  return map[key] || key;
}

/* ===== Persistent banner + first-visit modal logic ===== */
(function initDisclaimers(){
  // Banner dismiss
  const bannerKey = "pipc_disclaimer_banner_dismissed";
  const banner = document.getElementById("disclaimerBanner");
  const dismissBtn = document.getElementById("bannerDismissBtn");

  if (localStorage.getItem(bannerKey) === "1") {
    banner.style.display = "none";
  }
  dismissBtn.addEventListener("click", () => {
    localStorage.setItem(bannerKey, "1");
    banner.style.display = "none";
  });

  // First visit modal
  const firstVisitKey = "pipc_first_visit_ack";
  const firstOverlay = document.getElementById("firstVisitOverlay");
  const acknowledgeBtn = document.getElementById("acknowledgeBtn");

  function lockScroll(){
    document.body.style.overflow = "hidden";
  }
  function unlockScrollIfSafe(){
    // only unlock if your clinical overlay isn't open
    const clinicalOverlayOpen = overlay && overlay.style.display === "block";
    if (!clinicalOverlayOpen) document.body.style.overflow = "";
  }

  if (localStorage.getItem(firstVisitKey) !== "1") {
    firstOverlay.style.display = "flex";
    lockScroll();
  }

  acknowledgeBtn.addEventListener("click", () => {
    localStorage.setItem(firstVisitKey, "1");
    firstOverlay.style.display = "none";
    unlockScrollIfSafe();
  });
})();
</script>

<!-- Persistent disclaimer banner -->
<div class="disclaimer-banner" id="disclaimerBanner" role="note" aria-label="Clinical disclaimer">
  <div>
    <strong>Clinical support only.</strong>
    This site is a quick reference tool and does not replace clinical judgement or current guidelines.
  </div>
  <div class="banner-actions">
    <button class="btn" id="bannerDismissBtn" type="button">Dismiss</button>
    <a class="btn" href="about.html">Read more</a>
  </div>
</div>

<!-- Site-wide footer -->
<footer class="site-footer" aria-label="Footer">
  <div class="site-footer-inner">
    <div>¬© Paramedics in Primary Care ¬∑ Quick reference only</div>
    <div><a href="about.html">About / Disclaimer</a></div>
  </div>
</footer>

<!-- First-visit modal -->
<div class="modal-overlay" id="firstVisitOverlay" role="dialog" aria-modal="true" aria-label="First visit disclaimer">
  <div class="modal">
    <div class="modal-head">Before you use this tool</div>
    <div class="modal-body">
      <p>This resource is designed as a quick-reference aid for same-day, sudden and serious presentations.</p>
      <ul>
        <li>It does <strong>not</strong> replace clinical judgement.</li>
        <li>It does <strong>not</strong> replace national/local guidance (e.g. NICE) or service protocols.</li>
        <li>Escalate and follow emergency pathways if concerned.</li>
      </ul>
    </div>
    <div class="modal-foot">
      <a class="btn" href="about.html">Read full disclaimer</a>
      <button class="btn" id="acknowledgeBtn" type="button">I understand</button>
    </div>
  </div>
</div>

</body>
</html>
